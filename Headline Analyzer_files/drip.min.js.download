var Core=window.Core||{};Core.Drip=Core.Drip||function(r,e,d){"use strict";var a=function(e){var t=r.createElement("input");return t.type="email",t.required=!0,t.value=e,"function"==typeof t.checkValidity?t.checkValidity():/\S+@\S+\.\S+/.test(e)},n={visitor_uuid:"",userCity:"",userCountry:"",init:function(){d(r).ready(n.ready)},ready:function(){n.setCountry(),n.bindCheckoutEvents(),n.checkCookies()},checkCookies:function(){var e=n.getCookie("mi_drip_visitor_uuid");e&&(n.visitor_uuid=e)},bindCheckoutEvents:function(){if("undefined"!=typeof _dcq){var e=d("body"),t=d("#edd-email");e.hasClass("upgrade-purchase")&&""!==t.val()&&_dcq.push(["identify",{email:t.val(),abandoned_cart_url:n.edd.getAbandonmentURL("upgrade"),tags:[drip.tag_prefix+"-upgrade-to-"+drip.checkout_product_slug]}]),0<d(".edd-sl-renewal-details").length&&""!==t.val()&&_dcq.push(["identify",{email:t.val(),abandoned_cart_url:n.edd.getAbandonmentURL(),tags:[drip.tag_prefix+"-renewal-intent"]}]),e.hasClass("logged-in")||(t.on("blur",function(){var e=d(this).val();if(0<n.edd.getPlanId()&&a(e)){var t={email:e,abandoned_cart_url:n.edd.getAbandonmentURL(),tags:[drip.tag_prefix+"-abandoned",n.edd.getPlan()],success:function(e){e.visitor_uuid&&(n.visitor_uuid=e.visitor_uuid,n.setCookie("mi_drip_visitor_uuid",n.visitor_uuid,30))}};n.visitor_uuid&&(delete t.email,t.new_email=e),n.userCity&&(t.city=n.userCity),n.userCountry&&(t.country=n.userCountry),_dcq.push(["identify",t])}}),d("#edd-user-login").on("blur",function(){var e=n.edd.getName("username"),t=n.edd.getEmail();e.length&&a(t)&&_dcq.push(["identify",{email:t,username:e,abandoned_cart_url:n.edd.getAbandonmentURL()}])}),d("#edd-first").on("blur",function(){var e=n.edd.getName("first"),t=n.edd.getEmail();e.length&&a(t)&&_dcq.push(["identify",{email:t,first_name:e,abandoned_cart_url:n.edd.getAbandonmentURL()}])}),d("#edd-last").on("blur",function(){var e=n.edd.getName("last"),t=n.edd.getEmail();e.length&&a(t)&&_dcq.push(["identify",{email:t,last_name:e,abandoned_cart_url:n.edd.getAbandonmentURL()}])}),d("#edd-phone").on("blur",function(){var e=d(this),t=e.intlTelInput("getNumber"),i=n.edd.getEmail();setTimeout(function(){t.length&&e.intlTelInput("isValidNumber")&&a(i)&&_dcq.push(["identify",{email:i,plusthis:t,tags:[drip.tag_prefix+"-sms-cart-abandoned"],abandoned_cart_url:n.edd.getAbandonmentURL()}])},50)}))}},edd:{getEmail:function(){var e=d("#edd-email");return e.length?e.val():""},getPlan:function(){return drip.checkout_product_slug?drip.tag_prefix+"-"+drip.checkout_product_slug:""},getPlanId:function(){var e=0;if(!d("#edd_checkout_cart").length)return e;var t=d("#edd_checkout_cart .edd_cart_item").first().data("download-id");return void 0!==t&&(e=parseInt(t,10)),e},getDiscount:function(){return d(".edd_discount_remove").length?d(".edd_discount_remove").attr("data-code"):""},getName:function(e){var t="";if(!d("#edd_purchase_form").length)return t;switch(e){case"username":var i=d("#edd-user-login");t=i.length?i.val():"";break;case"first":var a=d("#edd-first");t=a.length?a.val():"";break;case"last":var n=d("#edd-last");t=n.length?n.val():"";break;case"full":t=this.getName("first")+" "+this.getName("last")}return d.trim(t)},getAbandonmentURL:function(e){var t=new URL(drip.checkout_url);return t.searchParams.set("nocache",1),t.searchParams.set("edd_action","add_to_cart"),t.searchParams.set("download_id",this.getPlanId()),"upgrade"!==e&&t.searchParams.set("discount",this.getDiscount()),t.searchParams.set("cemail",this.getEmail()),t.searchParams.set("clogin",this.getEmail()),t.searchParams.set("cfname",this.getName("first")),t.searchParams.set("clname",this.getName("last")),t}},getCookie:function(e){var t=r.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return t?t[2]:null},setCookie:function(e,t,i){var a="";if(i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3),a="; expires="+n.toUTCString()}r.cookie=e+"="+(t||"")+a+"; path=/"},setCountry:function(){if(Intl){var e=Intl.DateTimeFormat().resolvedOptions().timeZone.split("/");e[e.length-1]&&(n.userCity=e[e.length-1],timeZoneCityToCountry[n.userCity]&&(n.userCountry=timeZoneCityToCountry[n.userCity]))}}};return n}(document,window,jQuery),Core.Drip.init();